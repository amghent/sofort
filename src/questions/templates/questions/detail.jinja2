{% extends "forms/chat_form.jinja2" %}

{% block toolbar %}
    {{ toolbar_factory.back_button( url('questions_index', args=[interest_group.slug]) ) }}
{% endblock %}

{% block page_title %}
    {{ element_factory.page_title(question.title) }}
{% endblock %}

{% block detail %}
    {{ chat_factory.message_block(question_content()) }}

    {% for response in responses %}
        {{ chat_factory.response_block(response_content(response, comments)) }}
    {% endfor %}

    {{ chat_factory.message_block(response_form(question)) }}
{% endblock %}

{% macro question_content() %}
    {{ chat_factory.message(
            "question-" + question.id|string,
            question.author.display_name + " - " + question.created_at | dt_to_user_frmt,
            question.text,
            "Views: " + question.view_count|string + " - Responses: " + question.response_count|string +
                " - Comments: " + question.comment_count|string
    ) }}
{% endmacro %}

{% macro response_content(response, comments) %}
    {{ chat_factory.response(
        "response_" + response.id|string|replace("-", "_"),
        response.author.display_name + " - " + response.created_at | dt_to_user_frmt,
        response.text
    ) }}

    {% for comment in comments %}
        {% if comment.response == response %}
            {{ chat_factory.comment(
                "comment_" + comment.id|string|replace("-", "_"),
                comment.author.display_name + " - " + comment.created_at | dt_to_user_frmt,
                comment.text
            ) }}
        {% endif %}
    {% endfor %}

    {{ chat_factory.comment_block(comment_form(response)) }}
{% endmacro %}

{# do not touch below this line #}
{% macro response_form(question) %}
    {% include "config/server_side/questions/response.jinja2" %}
{% endmacro %}

{% macro comment_form(response) %}
    {% include "config/server_side/questions/comment.jinja2" %}
{% endmacro %}

{% block sidebar %}
    {% include "includes/interests/sidebar.jinja2" %}
{% endblock %}
